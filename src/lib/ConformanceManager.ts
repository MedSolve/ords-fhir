import {IConformance, Conformance}  from '../resources/internal/Conformance';
import {Enforce}                    from 'ts-objectschema';

/**
 * Manage every resource in the application
 */
export class ConformanceManager {
    /**
     * Instanceiated conformance resource
     */
    public conformance: Conformance;
    /**
     * Add some of the autogenerated conformance fields to the conformance
     * @param   {IConformance}  conformance     conformance that needs the fields added
     * @returns {Void}
     */
    public addAutoConformance(conformance: IConformance): void {

        conformance.name = 'Main conformance statement';
        conformance.status = 'active';
        conformance.kind = 'instance';
        conformance.fhirVersion = 'v1.0.2-7202';
        conformance.acceptUnknown = 'no';
        conformance.format = ['json'];
        conformance.rest = {
            mode: 'client',
            searchParam: [
                {
                    definition: 'http://hl7.org/fhir/SearchParameter/resource-security',
                    documentation: 'Security Labels applied to this resource',
                    name: '_security',
                    type: 'token',
                },
                {
                    definition: 'http://hl7.org/fhir/SearchParameter/resource-lastUpdated',
                    documentation: 'When the resource version last changed',
                    name: '_lastUpdated',
                    type: 'date'
                },
                {
                    definition: 'http://hl7.org/fhir/SearchParameter/resource-id',
                    documentation: 'Logical id of this artifact',
                    name: '_id',
                    type: 'token'
                },
                {
                    definition: 'http://hl7.org/fhir/SearchParameter/resource-profile',
                    documentation: 'Profiles this resource claims to conform to',
                    name: '_profile',
                    type: 'uri'
                },
                {
                    definition: 'http://hl7.org/fhir/SearchParameter/resource-tag',
                    documentation: 'Tags applied to this resource',
                    name: '_tag',
                    type: 'token'
                }
            ],
        }

    }
    /**
     * Build the conformance
     * @param   {IConformance}  conformance     conformance to be builded
     * @returns {Void}
     */
    public buildConformance(conformance: IConformance): void {

        // some more fields should be added to the conformance here

        // generate profile etc     profile?: Array<IReference>;

        this.conformance = new Conformance(conformance, Enforce.required);
    }
}
